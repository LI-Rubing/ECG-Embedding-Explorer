# ECG Embedding Explorer

## 1. 应用概述

本项目实现了一个基于 Streamlit 的交互式应用，用于探索 ECG 嵌入向量并联动显示 ECG 信号。用户可加载 embeddings 与 ECG 数据，进行 PCA / t-SNE / UMAP 降维，并在 2D 散点图上选择点查看对应 ECG 波形。应用支持过滤、按元数据着色以及导联选择。

## 2. 已实现功能

- 支持 `parquet / csv / pkl` 数据加载
- 数据验证（join key、embedding 长度一致性、缺失 ID）
- PCA / t-SNE / UMAP 降维与参数控制
- Plotly 2D 散点图与颜色映射
- 点击/选择点显示 ECG 波形与元数据
- 导联选择（隐藏/显示）

## 3. 遇到的困难

- 提供的数据集中部分预计算的 2D 列为空（全 NaN），需要在 UI 中提示并引导重新计算。
- parquet 数据体积较大时，完整缺失统计会带来较高开销，需要在稳健性与性能之间平衡。
- Streamlit 对 Plotly selection 的事件在大样本下不稳定，需要采样或备用交互方式。
- 在本地硬件内存有限的情况下，直接加载大体积 `pkl` 会占用较高内存，因此实际使用中更推荐先转为 `parquet` 再加载。
- 为减轻内存压力，ECG 可视化采用了 lazy loading：只有点击散点后才读取对应 ECG 行，因此首次绘制可能有一定延迟。
- 受限于硬件内存与浏览器渲染能力，在超大规模数据集下散点绘制可能出现不稳定或响应较慢的情况。

## 4. 可能的改进

- 增加关键功能单元测试（ID 映射、schema 验证）。
- 自动识别可用的 2D 列（避免全 NaN 列造成误解）。
- 改善点击交互稳定性。
- 增加更强的内存保护策略：对大文件强制走 parquet、限制一次性加载量。
- 优化 ECG 渲染性能：支持更轻量的分段绘制或惰性加载提示。
- 在大规模数据集下增加强制采样上限或提示用户缩小范围后再绘图。
